<?php

// try to reuse lib defined in a current symfony2 project
$autoload = __DIR__.'/../../../../app/autoload.php';

// if the bundle is the project, try to use the composer's autoload for the tests
$composerAutoload = __DIR__.'/../vendor/autoload.php';

if (is_file($autoload)) {
    include $autoload;
} elseif (is_file($composerAutoload)) {
	include $composerAutoload;
} else {
    $vendorDir = __DIR__.'/../vendor';
    require_once $vendorDir.'/symfony/src/Symfony/Component/ClassLoader/UniversalClassLoader.php';

    $loader = new Symfony\Component\ClassLoader\UniversalClassLoader();
    $loader->registerNamespaces(array(
        'Symfony'  => array($vendorDir.'/symfony/src'),
        'Knp'      => array($vendorDir.'/knpmenu/src'),
        'FOS'      => array($vendorDir),
        'JMS'      => array($vendorDir),
        'Buzz'     => array($vendorDir.'/buzz/lib'),
        'Doctrine' => array(
            $vendorDir.'/doctrine/lib',
            $vendorDir.'/doctrine-common/lib',
        ),
        'Application' => array(
            __DIR__,
        ),
        'Sonata'   => array(
            $vendorDir.'/../../src',
            $vendorDir,
            __DIR__.'/../src',
        )
    ));
    $loader->register();

    spl_autoload_register(function($class) {
        if (0 === strpos($class, 'Sonata\\AdminBundle\\')) {
            $path = __DIR__.'/../../'.implode('/', array_slice(explode('\\', $class), 2)).'.php';

            if (!stream_resolve_include_path($path)) {
                return false;
            }
            require_once $path;
            return true;
        }
    });
}
